---
title: "Exploring House Expenditures"
output:
  html_document: default
  html_notebook: default
---
```{r load packages}
library(dplyr, quietly = T)
```

### Loading Data

```{r load data}
# Set up your working directory
#setwd("~/Documents/github/house_expenditures")

# Download and read Q3 detail files from data.world
file_downloads <- c("https://query.data.world/s/5o0xnjfh6iuo0kh62b1rzp8xf", #2016
                    "https://query.data.world/s/a86tqnnfe16f03x6wuxk1z0g7", #2015
                    "https://query.data.world/s/7gm9yyoh8zjffcdnlpboc12sd", #2014
                    "https://query.data.world/s/3typrwb3pwd32jiqnusc5nfiw", #2013 
                    "https://query.data.world/s/9kfxw5pfebclr3sjmqppwy4at", #2012
                    "https://query.data.world/s/3fe96e3unm3pr0hw6ao9pynnd", #2011
                    "https://query.data.world/s/ak20z1hk153nyrghsejfuazjz", #2010
                    "https://query.data.world/s/30807xh494jhuk28slw6jhi1f"  #2009
)

alldata <- lapply(file_downloads, function(x) {read.csv(x, stringsAsFactors = F)})

df <- do.call(rbind, alldata) # Combine into one dataset
```

### Cleaning Data

I removed the commas in the AMOUNT column and changed the START.DATE and END.DATE 
columns to the date class. Dollar amounts were updated to reflect 2016 dollars as 
found on [http://www.usinflationcalculator.com/](http://www.usinflationcalculator.com/).

```{r clean data}
# Change class and remove commas
df$AMOUNT <- as.numeric(gsub(",", "", df$AMOUNT))

# Convert date variables to dates
df$START.DATE <- as.Date(df$START.DATE, format = "%m/%d/%y")
df$END.DATE <- as.Date(df$END.DATE, format = "%m/%d/%y")

# Convert to 2016 dollars
# q = quarter as character
# r = inflation rate found on http://www.usinflationcalculator.com/
convertDollars <- function(q, r) {
 round(df$AMOUNT[df$QUARTER == q] + (df$AMOUNT[df$QUARTER == q] * r), 2)
}

df$AMOUNT[df$QUARTER == "2009Q3"] <- convertDollars("2009Q3", .125) #Convert 2009
df$AMOUNT[df$QUARTER == "2010Q3"] <- convertDollars("2010Q3", .107) #Convert 2010
df$AMOUNT[df$QUARTER == "2011Q3"] <- convertDollars("2011Q3", .073) #Convert 2011
df$AMOUNT[df$QUARTER == "2012Q3"] <- convertDollars("2012Q3", .051) #Convert 2012
df$AMOUNT[df$QUARTER == "2013Q3"] <- convertDollars("2013Q3", .036) #Convert 2013
df$AMOUNT[df$QUARTER == "2014Q3"] <- convertDollars("2014Q3", .02)  #Convert 2014
df$AMOUNT[df$QUARTER == "2015Q3"] <- convertDollars("2015Q3", .018) #Convert 2015
```

### Functions

```{r load functions}
# What is the total yearly expenditure for an office during the Q3 measurement?
by_office <- df %>%
  group_by(OFFICE, QUARTER) %>%
  summarise("yearly_exp" = sum(AMOUNT))

officeYearly <- function(office) {
  by_office[by_office$OFFICE == office, ]
}

# What is the total yearly expenditure paid to a payee during the Q3 measurement?
by_payee <- df %>%
  group_by(PAYEE, QUARTER) %>%
  summarise("yearly_exp" = sum(AMOUNT))

payeeYearly <- function(payee) {
  by_payee[by_payee$PAYEE == payee, ]
}
```

### Example

What are the historical third quarter totals for ADMIN AND OPS in 2016 dollars?

```{r}
officeYearly("ADMIN AND OPS")
```